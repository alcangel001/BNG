{% extends "bingo_app/base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3><i class="fas fa-percentage me-2"></i>Configuración de Porcentajes</h3>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Administrador</label>
                        <div class="input-group">
                            {{ form.admin_percentage }}
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Organizador</label>
                        <div class="input-group">
                            {{ form.organizer_percentage }}
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Jugador</label>
                        <div class="input-group">
                            {{ form.player_percentage }}
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    La suma total debe ser exactamente 100%. Actual: 
                    <strong id="total-percentage">{{ settings.admin_percentage|add:settings.organizer_percentage|add:settings.player_percentage }}%</strong>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Guardar Cambios
                </button>
            </form>
        </div>
        <div class="card-footer text-muted">
            Última actualización: {{ settings.last_updated|date:"d M Y H:i" }} por {{ settings.updated_by.username|default:"Sistema" }}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('input[type="number"]');
    
    function calculateTotal() {
        let total = 0;
        inputs.forEach(input => {
            total += parseFloat(input.value) || 0;
        });
        document.getElementById('total-percentage').textContent = total.toFixed(2) + '%';
    }
    
    inputs.forEach(input => {
        input.addEventListener('change', calculateTotal);
        input.addEventListener('input', calculateTotal);
    });
});
</script>
{% endblock %}